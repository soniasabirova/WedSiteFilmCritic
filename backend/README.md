# –ö–∏–Ω–æ–ö—Ä–∏—Ç–∏–∫ - Backend

Backend –Ω–∞ Python Flask + PostgreSQL –¥–ª—è —Å–∞–π—Ç–∞ –ö–∏–Ω–æ–ö—Ä–∏—Ç–∏–∫.

## üê≥ –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫ —Å Docker

```bash
# –ò–∑ –∫–æ—Ä–Ω–µ–≤–æ–π –ø–∞–ø–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞
docker-compose up -d
```

–≠—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç:
- **PostgreSQL** –Ω–∞ –ø–æ—Ä—Ç—É 5432
- **Flask Backend** –Ω–∞ –ø–æ—Ä—Ç—É 5000

–°–∞–π—Ç –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω: http://localhost:5000

### –ö–æ–º–∞–Ω–¥—ã Docker

```bash
# –ó–∞–ø—É—Å–∫
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞
docker-compose down

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
docker-compose logs -f

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
docker-compose up -d --build

# –£–¥–∞–ª–µ–Ω–∏–µ —Å –¥–∞–Ω–Ω—ã–º–∏
docker-compose down -v
```

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
backend/
‚îú‚îÄ‚îÄ app.py              # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ config.py           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ models.py           # –ú–æ–¥–µ–ª–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ init_db.py          # –°–∫—Ä–∏–ø—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ë–î
‚îú‚îÄ‚îÄ requirements.txt    # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ Python
‚îú‚îÄ‚îÄ env_example.txt     # –ü—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ .env
‚îî‚îÄ‚îÄ routes/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ auth.py         # API –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    ‚îú‚îÄ‚îÄ movies.py       # API —Ñ–∏–ª—å–º–æ–≤
    ‚îî‚îÄ‚îÄ stats.py        # API —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PostgreSQL

–°–∫–∞—á–∞–π—Ç–µ –∏ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ PostgreSQL: https://www.postgresql.org/download/

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```sql
CREATE DATABASE kinocritic;
```

### 3. –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è Python

```bash
cd backend
python -m venv venv

# Windows:
venv\Scripts\activate

# Linux/Mac:
source venv/bin/activate
```

### 4. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

```bash
pip install -r requirements.txt
```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –ø–∞–ø–∫–µ `backend`:

```
DATABASE_URL=postgresql://postgres:–≤–∞—à_–ø–∞—Ä–æ–ª—å@localhost:5432/kinocritic
JWT_SECRET_KEY=–≤–∞—à-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á-jwt
SECRET_KEY=–≤–∞—à-—Å–µ–∫—Ä–µ—Ç–Ω—ã–π-–∫–ª—é—á-flask
```

### 6. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
python init_db.py
```

### 7. –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

```bash
python app.py
```

–°–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ http://localhost:5000

## API Endpoints

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| POST | `/api/auth/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è |
| POST | `/api/auth/login` | –í—Ö–æ–¥ |
| GET | `/api/auth/me` | –¢–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å |
| POST | `/api/auth/logout` | –í—ã—Ö–æ–¥ |

### –§–∏–ª—å–º—ã

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| GET | `/api/movies` | –í—Å–µ —Ñ–∏–ª—å–º—ã (—Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π) |
| GET | `/api/movies/recent` | –ü–æ—Å–ª–µ–¥–Ω–∏–µ 3 —Ñ–∏–ª—å–º–∞ |
| GET | `/api/movies/:id` | –§–∏–ª—å–º –ø–æ ID |
| POST | `/api/movies` | –î–æ–±–∞–≤–∏—Ç—å —Ñ–∏–ª—å–º |
| PUT | `/api/movies/:id` | –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–ª—å–º |
| DELETE | `/api/movies/:id` | –£–¥–∞–ª–∏—Ç—å —Ñ–∏–ª—å–º |

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| GET | `/api/stats/general` | –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ |
| GET | `/api/stats/monthly` | –ü–æ –º–µ—Å—è—Ü–∞–º |
| GET | `/api/stats/ratings` | –ü–æ –æ—Ü–µ–Ω–∫–∞–º |
| GET | `/api/stats/top` | –¢–æ–ø-5 —Ñ–∏–ª—å–º–æ–≤ |
| GET | `/api/stats/genres` | –ü–æ –∂–∞–Ω—Ä–∞–º |

## –¢–∞–±–ª–∏—Ü—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

### users
- `id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `username` - –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—É–Ω–∏–∫–∞–ª—å–Ω–æ–µ)
- `email` - Email (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π)
- `password_hash` - –•–µ—à –ø–∞—Ä–æ–ª—è (bcrypt)
- `created_at` - –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

### movies
- `id` - ID —Ñ–∏–ª—å–º–∞
- `user_id` - ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `title` - –ù–∞–∑–≤–∞–Ω–∏–µ
- `type` - –¢–∏–ø (film/series)
- `genre` - –ñ–∞–Ω—Ä
- `rating` - –û—Ü–µ–Ω–∫–∞ (1-5)
- `watch_date` - –î–∞—Ç–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
- `review` - –û—Ç–∑—ã–≤
- `created_at` - –î–∞—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è
- `updated_at` - –î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

